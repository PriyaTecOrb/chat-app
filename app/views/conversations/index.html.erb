<!-- app/views/conversations/index.html.erb -->
<div class="row g-0 h-100">
  <!-- Conversations List -->
  <div class="col-md-4 border-end" style="height: 100vh; overflow-y: auto;">
    <div class="p-3 border-bottom bg-light">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0 fw-bold">Messages</h2>
        <%= link_to new_conversation_path, class: "btn btn-sm btn-primary rounded-pill" do %>
          <i class="bi bi-plus-lg me-1"></i> New Chat
        <% end %>
      </div>
    </div>

    <div class="conversation-list">
      <% @conversations.each do |conversation| %>
        <%= link_to conversation_path(conversation), 
            class: "conversation-item d-flex align-items-center p-3 text-decoration-none text-dark border-bottom" do %>
          <div class="flex-shrink-0 me-3">
            <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" 
                 style="width: 48px; height: 48px;">
              <i class="bi bi-people-fill text-primary fs-5"></i>
            </div>
          </div>
          <div class="flex-grow-1 overflow-hidden">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <h6 class="mb-0 fw-bold text-truncate">
                <%= conversation.title %>
              </h6>
              <small class="text-muted">
                <%= time_ago_in_words(conversation.updated_at) %> ago
              </small>
            </div>
            <p class="mb-0 text-muted text-truncate small">
              <% if conversation.last_message %>
                <% if conversation.last_message.user == current_user %>
                  You: 
                <% elsif conversation.users.count > 2 %>
                  <%= conversation.last_message.user.username %>: 
                <% end %>
                <%= truncate(conversation.last_message.content, length: 30) %>
              <% else %>
                No messages yet
              <% end %>
            </p>
          </div>
          <% if (unread = conversation.unread_count(current_user)) > 0 %>
            <span class="badge bg-primary rounded-pill ms-2">
              <%= unread %>
            </span>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Conversation Area -->
  <div class="col-md-8 d-flex flex-column" style="height: 100vh;">
    <div class="d-flex flex-column justify-content-center align-items-center h-100 text-muted">
      <div class="mb-3">
        <i class="bi bi-chat-square-text display-4"></i>
      </div>
      <h4 class="mb-2">Select a conversation</h4>
      <p class="mb-0">or start a new chat with someone</p>
    </div>
  </div>
</div>

<style>
  .conversation-item {
    transition: background-color 0.2s;
  }
  
  .conversation-item:hover {
    background-color: #f8f9fa;
  }
  
  .conversation-item.active {
    background-color: #f1f3f5;
  }
  
  .conversation-list {
    max-height: calc(100vh - 120px);
    overflow-y: auto;
  }
  
  .unread {
    font-weight: 600;
  }
</style>