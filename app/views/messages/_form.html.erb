<!-- app/views/messages/_form.html.erb -->
<%= form_with(model: [conversation, message], 
    data: { 
      controller: "message-form",
      action: "turbo:submit-end->message-form#resetForm"
    }) do |f| %>
  <div class="input-group">
    <%= f.text_area :content, 
          class: "form-control", 
          placeholder: "Type your message...",
          rows: 1,
          data: { 
            message_form_target: "input",
            action: "keydown.enter->message-form#handleKeydown"
          } %>
    
    <div class="input-group-append">
      <label class="btn btn-outline-secondary" style="cursor: pointer;">
        <i class="bi bi-paperclip"></i>
        <%= f.file_field :attachments, 
              multiple: true, 
              style: "display: none;",
              data: { action: "change->message-form#handleFiles" } %>
      </label>
      <%= f.button type: "submit", class: "btn btn-primary" do %>
        <i class="bi bi-send"></i>
      <% end %>
    </div>
  </div>
  
  <div id="file-preview" class="mt-2" data-message-form-target="filePreview"></div>
<% end %>

<%= javascript_tag nonce: true do %>
  document.addEventListener("DOMContentLoaded", function() {
    // Auto-resize textarea
    const textarea = document.querySelector("textarea[data-message-form-target='input']");
    if (textarea) {
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
    }
    
    // Scroll to bottom of messages
    const messagesContainer = document.getElementById('messages');
    if (messagesContainer) {
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
  });
<% end %>